<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modular Structure</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #output {
            margin-top: 20px;
            padding: 10px;
            background: #333;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Test Modular Structure</h1>
    
    <div class="test-section">
        <h2>State Management</h2>
        <button onclick="testState()">Test State</button>
        <button onclick="testStateSubscription()">Test Subscription</button>
    </div>
    
    <div class="test-section">
        <h2>Notifications</h2>
        <button onclick="testNotifications()">Test All Notification Types</button>
    </div>
    
    <div class="test-section">
        <h2>DOM Utils</h2>
        <button onclick="testDOMUtils()">Test DOM Utils</button>
        <div id="testDiv" style="display: none; margin-top: 10px; padding: 10px; background: #444;">
            Hidden Test Div
        </div>
    </div>
    
    <div class="test-section">
        <h2>Module Loading</h2>
        <button onclick="checkModules()">Check All Modules</button>
    </div>
    
    <div id="output"></div>
    
    <script type="module">
        import { appState } from './js/modules/state.js';
        import { notifications } from './js/modules/notifications.js';
        import { DOMUtils } from './js/modules/dom-utils.js';
        import { apiClient } from './js/modules/api-client.js';
        
        const output = document.getElementById('output');
        
        function log(message) {
            output.textContent += message + '\n';
            console.log(message);
        }
        
        // Make functions global for onclick handlers
        window.testState = function() {
            log('Testing State Management...');
            
            // Test setting state
            appState.setState({ testValue: 'Hello World' });
            log('Set testValue: ' + appState.getState().testValue);
            
            // Test getting specific property
            log('Current user: ' + JSON.stringify(appState.currentUser));
            log('Is loading: ' + appState.isLoading);
        };
        
        window.testStateSubscription = function() {
            log('Testing State Subscription...');
            
            // Subscribe to changes
            const unsubscribe = appState.subscribe((property) => {
                log(`State changed: ${property} = ${JSON.stringify(appState.getState()[property])}`);
            });
            
            // Make some changes
            appState.setState({ testCounter: 1 });
            appState.setState({ testCounter: 2 });
            
            // Unsubscribe
            unsubscribe();
            log('Unsubscribed from state changes');
        };
        
        window.testNotifications = function() {
            log('Testing Notifications...');
            notifications.success('Success notification!');
            setTimeout(() => notifications.error('Error notification!'), 500);
            setTimeout(() => notifications.warning('Warning notification!'), 1000);
            setTimeout(() => notifications.info('Info notification!'), 1500);
        };
        
        window.testDOMUtils = function() {
            log('Testing DOM Utils...');
            
            const testDiv = document.getElementById('testDiv');
            
            // Test show/hide
            DOMUtils.show(testDiv);
            log('Showed test div');
            
            setTimeout(() => {
                DOMUtils.hide(testDiv);
                log('Hid test div');
            }, 2000);
            
            // Test element creation
            const newEl = DOMUtils.createElement('div', {
                className: 'test-element',
                textContent: 'Created with DOMUtils',
                attributes: { 'data-test': 'value' }
            });
            
            testDiv.appendChild(newEl);
            log('Created new element');
            
            // Test HTML escaping
            const dangerous = '<script>alert("XSS")</script>';
            const safe = DOMUtils.escapeHtml(dangerous);
            log('Escaped HTML: ' + safe);
        };
        
        window.checkModules = function() {
            log('Checking Module Loading...');
            
            const modules = {
                appState,
                notifications,
                DOMUtils,
                apiClient
            };
            
            Object.entries(modules).forEach(([name, module]) => {
                log(`${name}: ${module ? 'Loaded ✓' : 'Failed ✗'}`);
            });
            
            // Check if app is initialized
            if (window.dentalBrainApp) {
                log('DentalBrainApp: Loaded ✓');
                log('Modules: ' + Object.keys(window.dentalBrainApp.modules).join(', '));
            } else {
                log('DentalBrainApp: Not initialized yet');
            }
        };
        
        // Initial log
        log('Test page loaded. Modules imported successfully.');
    </script>
</body>
</html>